<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>WhereApp â€” Space Chat</title>
 <style>
   * { box-sizing: border-box; }
   body {
     margin: 0;
     font-family: 'Poppins', sans-serif;
     background: radial-gradient(circle at 20% 20%, #0b0f2b, #020617 70%);
     height: 100vh;
     overflow: hidden;
     color: white;
     display: flex;
     justify-content: center;
     align-items: center;
   }


   #space-bg {
     position: fixed;
     top: 0; left: 0; right: 0; bottom: 0;
     background: repeating-radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 2px);
     background-size: 2px 2px;
     opacity: 0.25;
     animation: drift 120s linear infinite;
     z-index: 0;
   }


   @keyframes drift {
     from { background-position: 0 0; }
     to { background-position: 2000px 2000px; }
   }


   #chat-wrapper {
     position: relative;
     display: flex;
     width: 900px;
     height: 85vh;
     background: rgba(10, 15, 40, 0.9);
     border-radius: 20px;
     box-shadow: 0 0 25px rgba(59,130,246,0.4);
     overflow: hidden;
     z-index: 1;
   }


   #user-list {
     width: 220px;
     background: rgba(15, 23, 42, 0.95);
     border-right: 1px solid rgba(255,255,255,0.1);
     padding: 20px;
     display: flex;
     flex-direction: column;
   }


   #user-list h3 {
     margin: 0 0 10px;
     font-size: 1rem;
     color: #38bdf8;
     text-shadow: 0 0 6px rgba(56,189,248,0.6);
   }


   .user {
     padding: 6px 0;
     font-size: 0.9rem;
     display: flex;
     align-items: center;
     gap: 6px;
   }


   .dot {
     width: 8px; height: 8px;
     border-radius: 50%;
     background: #22c55e;
     box-shadow: 0 0 6px #22c55e;
   }


   #chat-container {
     flex: 1;
     display: flex;
     flex-direction: column;
   }


   header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     padding: 12px 20px;
     background: linear-gradient(90deg,#3b82f6,#9333ea,#06b6d4);
     font-weight: 600;
     font-size: 1.1rem;
   }


   #back-btn {
     background: transparent;
     border: none;
     color: white;
     cursor: pointer;
     font-size: 0.9rem;
     opacity: 0.8;
   }
   #back-btn:hover { opacity: 1; text-decoration: underline; }


   #messages {
     flex: 1;
     overflow-y: auto;
     padding: 15px;
     display: flex;
     flex-direction: column;
     scroll-behavior: smooth;
   }


   .message {
     max-width: 75%;
     padding: 10px 15px;
     border-radius: 15px;
     margin: 6px 0;
     line-height: 1.4;
     animation: fadeIn 0.3s ease;
   }


   .sent {
     background: linear-gradient(135deg,#2563eb,#06b6d4);
     align-self: flex-end;
     border-bottom-right-radius: 0;
   }


   .received {
     background: rgba(255,255,255,0.1);
     border: 1px solid rgba(255,255,255,0.1);
     align-self: flex-start;
     border-bottom-left-radius: 0;
   }


   @keyframes fadeIn {
     from { opacity: 0; transform: translateY(4px); }
     to { opacity: 1; transform: translateY(0); }
   }


   .typing-bubble {
     display: flex;
     align-items: center;
     justify-content: flex-start;
     width: fit-content;
     padding: 10px 15px;
     border-radius: 15px;
     background: rgba(255, 255, 255, 0.1);
     border: 1px solid rgba(255, 255, 255, 0.1);
     animation: fadeIn 0.3s ease;
   }


   .typing-bubble .dots span {
     height: 8px; width: 8px;
     margin: 0 3px;
     background-color: #9ca3af;
     border-radius: 50%;
     animation: blink 1.4s infinite both;
   }


   @keyframes blink {
     0%, 80%, 100% { opacity: 0.2; }
     40% { opacity: 1; }
   }


   #input-area {
     display: flex;
     padding: 10px;
     background: rgba(2,6,23,0.9);
     border-top: 1px solid rgba(255,255,255,0.1);
     gap: 10px;
   }


   #message-input {
     flex: 1;
     border: none;
     border-radius: 20px;
     padding: 10px 15px;
     background: rgba(255,255,255,0.1);
     color: white;
     font-size: 0.9rem;
   }


   #send-btn {
     background: linear-gradient(135deg,#3b82f6,#06b6d4);
     border: none;
     padding: 10px 20px;
     border-radius: 20px;
     color: white;
     cursor: pointer;
   }
 </style>
</head>


<body>
 <div id="space-bg"></div>


 <div id="chat-wrapper">
   <aside id="user-list">
     <h3>Active Users</h3>
     <div id="users"></div>
   </aside>


   <div id="chat-container">
     <header>
       <span>WhereApp</span>
       <button id="back-btn" onclick="window.location.href='login.html'">Back to Login</button>
     </header>


     <div id="messages"></div>


     <div id="input-area">
       <input type="text" id="message-input" placeholder="Type a message..." />
       <button id="send-btn">Send</button>
     </div>
   </div>
 </div>


 <script src="/socket.io/socket.io.js"></script>
 <script>
   const socket = io();
   const username = sessionStorage.getItem("msngr_user") || "Anonymous";


   const messages = document.getElementById("messages");
   const input = document.getElementById("message-input");
   const sendBtn = document.getElementById("send-btn");
   const usersDiv = document.getElementById("users");


   // Tell server a new user joined
   socket.emit("newUser", username);


   function appendMessage(text, type, user="") {
     const msg = document.createElement("div");
     msg.classList.add("message", type);
     msg.textContent = user ? `${user}: ${text}` : text;
     messages.appendChild(msg);
     messages.scrollTop = messages.scrollHeight;
   }


   function sendMessage() {
     const text = input.value.trim();
     if (!text) return;


     // Show message in sender's window
     appendMessage(text, "sent", username);


     // Send full payload to server
     socket.emit("chatMessage", {
       user: username,
       message: text
     });


     input.value = "";
     socket.emit("stopTyping", username);
   }


   sendBtn.addEventListener("click", sendMessage);
   input.addEventListener("keypress", e => {
     if (e.key === "Enter") sendMessage();
   });


   input.addEventListener("input", () => {
     socket.emit("typing", username);
     clearTimeout(window.typingTimeout);
     window.typingTimeout = setTimeout(() => {
       socket.emit("stopTyping", username);
     }, 1500);
   });


   // Only show incoming messages from OTHER USERS
   socket.on("chatMessage", data => {
     if (data.user !== username) {
       appendMessage(data.msg, "received", data.user);
     }
   });


   // Typing indicator
   let typingBubble = null;


   socket.on("typing", user => {
     if (user === username) return;


     if (!typingBubble) {
       typingBubble = document.createElement("div");
       typingBubble.classList.add("message", "received", "typing-bubble");
       typingBubble.innerHTML = `
         <div class="dots">
           <span></span><span></span><span></span>
         </div>`;
       messages.appendChild(typingBubble);
       messages.scrollTop = messages.scrollHeight;
     }
   });


   socket.on("stopTyping", user => {
     if (user === username) return;
     if (typingBubble) {
       typingBubble.remove();
       typingBubble = null;
     }
   });


   // User list
socket.on("activeUsers", (list) => {
  usersDiv.innerHTML = ""; // Clear old list

  list.forEach(user => {
    const div = document.createElement("div");
    div.classList.add("user");
    div.innerHTML = `<span class="dot"></span>${user}`;
    usersDiv.appendChild(div);
  });
});


 </script>
</body>
</html>





